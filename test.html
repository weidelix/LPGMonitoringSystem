<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Test mode</title>
    <!--Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
</head>
<style>
	body {
		background-color: white;
		font-family: 'Ubuntu';
		margin: 0px 0px;
		padding: 0px 0px;
	}


	.big-heading {
		line-height: 1.5;
		font-family: "Ubuntu";
	}

	#title {
		color: black;
	}

	.config {

	}

	.container-fluid {
		padding: 1% 5%;
		max-width: 800px;
	}

	input[type=number] {
		width: 70px;
		height: 30px;
	}
</style>
<body>
<div class="container-fluid">
    <form name="config" id="content">
        <div class="container-fluid">
            <div class="row my-4">
                <div class="col lg-6">
                    <label class="display-5 fw-bold">Test mode</label>
                </div>
            </div>
            <div class="d-flex flex-row justify-content-between my-2">
                <div>
                    <label>Enable test mode</label>
                </div>
                <div>
                    <div class="form-check form-switch">
                        <input name="on" class="form-check-input" type="checkbox"
                               id="flexSwitchCheckDefault">
                    </div>
                </div>
            </div>
            <div><div>
                    <label>Gas level: (%)</label>
                </div>

                <div>
                    <input name="gas_level" type="number" class="form-control" value="0">
                </div>
            </div>
            <button type="button" onclick="resetState()" class="btn btn-dark btn-lg fs-6 sticky-top">Reset State</button>
            <button type="submit" class="btn btn-dark btn-lg fs-6 sticky-top">Save</button>
        </div>
    </form>
</div>
<script>
    let form = document.forms['config'];
    form.addEventListener('submit', saveConfig);

    addEventListener("DOMContentLoaded", (event) => {
        request('/gettestconfig', 'GET', null).then(result => {
            form.on.checked = result.on
            form.gas_level.value = result.gas_level
		});
    });

    function resetState() {
        request('/resetstate', 'GET', null);
    }

    function saveConfig(e)
    {
        let formData = {
            'on': this.on.checked,
            'gas_level': parseInt(this.gas_level.value),
        }

        request('/settestconfig', 'POST', JSON.stringify(formData))
    }

    function request(route, method, body) {
        return fetch(route, {
            method: method,
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: body
        }).then(response => response.json())
    }

</script>
</body>
</html>